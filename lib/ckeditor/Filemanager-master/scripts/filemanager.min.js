/*
	MIT License
 @author		Jason Huck - Core Five Labs
 @author		Simon Georget <simon (at) linea21 (dot) com>
 @copyright	Authors
*/
(function(a){function O(a){var c=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!c)throw Error("XMLHttpRequest not supported");c.open("HEAD",a,!1);c.send(null);return 200==c.status?!0:!1}function p(b,c){return"dir"!=b["File Type"]||"download"!=c&&"replace"!=c?"undefined"==typeof b.Capabilities?!0:-1<a.inArray(c,b.Capabilities):!1}function t(b){var c=b.attr("class").replace(/ /g,"_");if(""==c)return"itemOptions";if(!a("#"+c).length){var d=a("#itemOptions").clone().attr("id",
c);b.hasClass("cap_select")||a(".select",d).remove();b.hasClass("cap_download")||a(".download",d).remove();b.hasClass("cap_rename")||a(".rename",d).remove();b.hasClass("cap_move")||a(".move",d).remove();a(".replace",d).remove();b.hasClass("cap_delete")||a(".delete",d).remove();a("#itemOptions").after(d)}return c}a.urlParam=function(a){return(a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(window.location.href))?a[1]:0};var u=function(b){var c=null;a.ajax({async:!1,url:"user"==("undefined"===typeof b?
"user":b)?"./scripts/filemanager.config.js":"./scripts/filemanager.config.js.default",dataType:"json",cache:!1,success:function(a){c=a}});return c},P=u("default"),g=u(),g=a.extend({},P,g);if(g.options.logger)var Q=(new Date).getTime();HEAD_included_files=[];loadCSS=function(b){if(-1==a.inArray(b,HEAD_included_files)){var c=a("<link rel='stylesheet' type='text/css' href='"+b+"'>");a("head").append(c);HEAD_included_files.push(b)}};loadJS=function(b){if(-1==a.inArray(b,HEAD_included_files)){var c=a("<script type='text/javascript' src='"+
b+"'>");a("head").append(c);HEAD_included_files.push(b)}};var l=g.options.fileConnector||"connectors/"+g.options.lang+"/filemanager."+g.options.lang,k=g.options.capabilities||"select download rename move delete replace".split(" ");0!=a.urlParam("langCode")&&O("scripts/languages/"+a.urlParam("langCode")+".js")&&(g.options.culture=a.urlParam("langCode"));var f=[];a.ajax({url:"scripts/languages/"+g.options.culture+".js",async:!1,dataType:"json",success:function(a){f=a}});a.prompt.setDefaults({overlayspeed:"fast",
show:"fadeIn",opacity:.4,persistent:!1});var E=function(){var b=20;!0===g.options.searchBox&&(b+=33);a.urlParam("CKEditorCleanUpFuncNum")&&(b+=60);b=a(window).height()-a("#uploader").height()-b;a("#splitter, #filetree, #fileinfo, .vsplitbar").height(b);b=a("#splitter").width()-a("div.vsplitbar").width()-a("#filetree").width();a("#fileinfo").width(b)},v=function(a,c){c="undefined"===typeof c?!0:!1;if(0==g.options.showFullPath){if("function"===typeof displayPathDecorator)return displayPathDecorator(a.replace(fileRoot,
"/"));a=a.replace(fileRoot,"/");if(50<a.length&&!0===c){var d=a.split("/");a="/"+d[1]+"/"+d[2]+"/(...)/"+d[d.length-2]+"/"}}return a},y=function(b){"grid"==b?(a("#grid").addClass("ON"),a("#list").removeClass("ON")):(a("#list").addClass("ON"),a("#grid").removeClass("ON"))},z=function(a){var c="",c="\u0160\u0161\u0110\u0111\u017d\u017e\u010c\u010d\u0106\u0107\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00c6\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u0150\u00d8\u00d9\u00da\u00db\u00dc\u00dd\u00de\u00df\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u0151\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fd\u00fe\u00ff\u0154\u0155 '/".split(""),
d="S s Dj dj Z z C c C c A A A A A A A C E E E E I I I I N O O O O O O O U U U U Y B Ss a a a a a a a c e e e e i i i i o n o o o o o o o u u u u y y b y R r _ _ ".split(" ");a=String(a);for(i=0;i<c.length;i++)a=a.replace(RegExp(c[i],"g"),d[i]);c=a;g.options.chars_only_latin&&(c=c.replace(/[^_a-zA-Z0-9]/g,""));return c=c.replace(/[_]+/g,"_")},R=function(a){filename="";-1!=a.lastIndexOf(".")?(filename=z(a.substr(0,a.lastIndexOf("."))),filename+="."+a.split(".").pop()):filename=z(a);return filename},
F=function(a){a=parseFloat(a);for(var c=0,d=[f.bytes,f.kb,f.mb,f.gb];;){if(1024>a)return a=Math.round(100*a)/100,a+d[c];a/=1024;c+=1}},G=function(b){a("#fileinfo").html("<h1>"+b+"</h1>");a("#newfile").attr("disabled","disabled");a("#upload").attr("disabled","disabled");a("#newfolder").attr("disabled","disabled")},H=function(b){b=q(b);return""==b&&1==g.security.allowNoExtension||"DISALLOW_ALL"==g.security.uploadPolicy&&-1!=a.inArray(b,g.security.uploadRestrictions)||"ALLOW_ALL"==g.security.uploadPolicy&&
-1==a.inArray(b,g.security.uploadRestrictions)?!0:!1},q=function(a){return 1==a.split(".").length?"":a.split(".").pop().toLowerCase()},S=function(a){return-1!=a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},T=function(b){var c="<video width="+g.videos.videosPlayerWidth+" height="+g.videos.videosPlayerHeight+' src="'+b.Path+'" controls="controls">',c=c+('<img src="'+b.Preview+'" />'),c=c+"</video>";a("#fileinfo img").remove();a("#fileinfo #preview h1").before(c)},U=function(b){var c='<audio src="'+
b.Path+'" controls="controls">',c=c+('<img src="'+b.Preview+'" />'),c=c+"</audio>";a("#fileinfo img").remove();a("#fileinfo #preview h1").before(c)},V=function(b){a("#fileinfo").find("td:first-child").each(function(){var c=a(this).attr("data-path"),c=a("#filetree").find('a[data-path="'+c+'"]').parent();"undefined"!==typeof c.css("background-image")&&(a(this).css("background-image",c.css("background-image")),window.clearInterval(b))})},A=function(b){a("#currentpath").val(b);a("#uploader h1").text(f.current_folder+
v(b)).attr("title",v(b,!1)).attr("data-path",b);a("#newfolder").unbind().click(function(){var b=f.default_foldername,d=f.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+b+'" />',e={};e[f.create_folder]=!0;e[f.cancel]=!1;a.prompt(d,{callback:function(e,d){if(1!=e)return!1;var g=d.children("#fname").val();""!=g?(b=z(g),g=new Date,a.getJSON(l+"?mode=addfolder&path="+a("#currentpath").val()+"&name="+b+"&time="+g.getMilliseconds(),function(b){0==b.Code?(W(b.Parent,b.Name),n(b.Parent),
a("#filetree").find('a[data-path="'+b.Parent+'/"]').click().click()):a.prompt(b.Error)})):a.prompt(f.no_foldername)},buttons:e})})},N=function(b){a("#fileinfo button").each(function(b){0==a(this).find("span").length&&a(this).wrapInner("<span></span>")});if(p(b,"select")){if(a("#fileinfo").find("button#select").click(function(){B(b)}).show(),window.opener||window.tinyMCEPopup)a("#preview img").attr("title",f.select),a("#preview img").click(function(){B(b)}).css("cursor","pointer")}else a("#fileinfo").find("button#select").hide();
p(b,"rename")?a("#fileinfo").find("button#rename").click(function(){var c=J(b);c.length&&a("#fileinfo > h1").text(c)}).show():a("#fileinfo").find("button#rename").hide();p(b,"move")?a("#fileinfo").find("button#move").click(function(){var c=K(b);c.length&&a("#fileinfo > h1").text(c)}).show():a("#fileinfo").find("button#move").hide();p(b,"replace")?a("#fileinfo").find("button#replace").click(function(){L(b)}).show():a("#fileinfo").find("button#replace").hide();p(b,"delete")?a("#fileinfo").find("button#delete").click(function(){M(b)&&
a("#fileinfo").html("<h1>"+f.select_from_left+"</h1>")}).show():a("#fileinfo").find("button#delete").hide();p(b,"download")?a("#fileinfo").find("button#download").click(function(){window.location=l+"?mode=download&path="+encodeURIComponent(b.Path)}).show():a("#fileinfo").find("button#download").hide()},x=function(){a("#filetree").fileTree({root:fileRoot,datafunc:X,multiFolder:!1,folderCallback:function(a){n(a)},expandedFolder:fullexpandedFolder,after:function(b){a("#filetree").find("li a").each(function(){a(this).contextMenu({menu:t(a(this))},
function(b,d,e){d=a(d).attr("data-path");w(b,d)})});1==g.options.searchBox&&(a("#q").liveUpdate("#filetree ul").blur(),a("#search span.q-inactive").html(f.search),a("#search a.q-reset").attr("title",f.search_reset))}},function(a){C(a)})},B=function(b){var c=!1!==g.options.relPath?relPath+b.Path.replace(fileRoot,""):relPath+b.Path;window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("CKEditorCleanUpFuncNum")||a.urlParam("CKEditor")?window.tinyMCEPopup?(b=tinyMCEPopup.getWindowArg("window"),
b.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=c,"undefined"!=typeof b.ImageDialog&&(b.ImageDialog.getImageData&&b.ImageDialog.getImageData(),b.ImageDialog.showPreviewImage&&b.ImageDialog.showPreviewImage(c)),tinyMCEPopup.close()):(a.urlParam("field_name")?(parent.document.getElementById(a.urlParam("field_name")).value=c,"undefined"!==typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!==typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()):
a.urlParam("CKEditor")?window.opener?window.opener.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),c):(parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))):""!=b.Properties.Width?window.opener.SetUrl(c,b.Properties.Width,b.Properties.Height):window.opener.SetUrl(c),window.opener&&window.close()):a.prompt(f.fck_select_integration)},J=function(b){var c="",d=g.security.allowChangeExtensions?b.Filename:
S(b.Filename),d=f.new_filename+' : <input id="rname" name="rname" type="text" value="'+d+'" />',e={};e[f.rename]=!0;e[f.cancel]=!1;a.prompt(d,{callback:function(e,d){if(1!=e)return!1;rname=d.children("#rname").val();if(""!=rname){var h=rname;if(!g.security.allowChangeExtensions){var h=R(rname),I=q(b.Filename);0<I.length&&(h=h+"."+I)}if("/"!=b.Path.charAt(b.Path.length-1)&&!H(h))return h="<p>"+f.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==g.security.uploadPolicy&&(h+="<p>"+f.ALLOWED_FILE_TYPE+g.security.uploadRestrictions.join(", ")+
".</p>"),"ALLOW_ALL"==g.security.uploadPolicy&&(h+="<p>"+f.DISALLOWED_FILE_TYPE+g.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(h),!1;var r=b.Path;a.ajax({type:"GET",url:l+"?mode=rename&old="+b.Path+"&new="+h,dataType:"json",async:!1,success:function(e){if(0==e.Code){var d=e["New Path"],s=e["New Name"],m=a("#filetree").find('a[data-path="'+r+'"]'),h=m.parent().parent().prev("a");m.attr("data-path",d).text(s);0==h.length?x():h.click().click();m=a("#preview h1").attr("title");
"undefined"!=typeof m&&m==r&&a("#preview h1").text(s);"grid"==a("#fileinfo").data("view")?(a('#fileinfo img[data-path="'+r+'"]').parent().next("p").text(s),a('#fileinfo img[data-path="'+r+'"]').attr("data-path",d)):(a('#fileinfo td[data-path="'+r+'"]').text(s),a('#fileinfo td[data-path="'+r+'"]').attr("data-path",d));a("#preview h1").html(s);b.Path=d;b.Filename=s;a("#fileinfo").find("button#rename, button#delete, button#download").unbind();N(b);g.options.showConfirmation&&a.prompt(f.successful_rename)}else a.prompt(e.Error);
c=e["New Name"]}})}},buttons:e});return c},L=function(b){a("#fileR").bind("change",function(){a(this).closest("form#toolbar").submit()});a("#toolbar").attr("action",l);a("#toolbar").attr("method","post");a("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(c,d,e){c=a("#fileR",d).val();if(""==c)return!1;if(q(c)!=b["File Type"])return a.prompt(f.ERROR_REPLACING_FILE+" ."+q(b.Filename)),!1;a("#replace").attr("disabled",!0);a("#upload span").addClass("loading").text(f.loading_data);
if("undefined"!==typeof FileReader&&"auto"!=typeof g.upload.fileSizeLimit&&a("#fileR",d).get(0).files[0].size>1048576*g.upload.fileSizeLimit)return a.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+g.upload.fileSizeLimit+" "+f.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1},error:function(b,d,e){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);a.prompt(f.ERROR_UPLOADING_FILE)},success:function(b){b=
jQuery.parseJSON(a("#uploadresponse").find("textarea").text());0==b.Code?(b=b.Path+"/"+b.Name,C(b),a("#preview").find("img").hide().fadeIn("slow"),a("ul.jqueryFileTree").find('li a[data-path="'+b+'"]').parent().hide().fadeIn("slow"),g.options.showConfirmation&&a.prompt(f.successful_replace)):a.prompt(b.Error);a("#replace").removeAttr("disabled");a("#upload span").removeClass("loading").text(f.upload)}});a("#newfilepath").val(b.Path);a("#fileR").click()},K=function(b){var c="",d=f.move+' : <input id="rname" name="rname" type="text" value="" />',
e={};e[f.move]=!0;e[f.cancel]=!1;a.prompt(d,{callback:function(e,d){if(1!=e)return!1;rname=d.children("#rname").val();if(""!=rname){var h=rname,h=l+"?mode=move&old="+encodeURIComponent(b.Path)+"&new="+encodeURIComponent(h)+"&root="+encodeURIComponent(fileRoot);a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(b){if(0==b.Code){var e=b["New Path"],d=b["New Name"];fullexpandedFolder=e;x();n(e);g.options.showConfirmation&&a.prompt(f.successful_moved)}else a.prompt(b.Error);c=e+d}})}},
buttons:e});return c},M=function(b){var c=!1,d=f.confirmation_delete,e={};e[f.yes]=!0;e[f.no]=!1;a.prompt(d,{callback:function(e,d){if(1!=e)return!1;var h=new Date,h=l+"?mode=delete&path="+encodeURIComponent(b.Path)+"&time="+h.getMilliseconds(),k=b.Path.split("/").reverse().slice(1).reverse().join("/")+"/";a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(b){0==b.Code?(Y(b.Path),b=b.Path.substring(0,b.Path.length-1),b=b.substr(0,b.lastIndexOf("/")+1),a("#uploader h1").text(f.current_folder+
v(b)).attr("title",v(b,!1)).attr("data-path",b),c=!0,g.options.showConfirmation&&a.prompt(f.successful_delete),a("#filetree").find('a[data-path="'+k+'/"]').click().click()):(c=!1,a.prompt(b.Error))}})},buttons:e});return c},Z=function(b){isEdited=!1;a("#fileinfo").find("h1").append(' <a id="edit-file" href="#" title="'+f.edit+'"><span>'+f.edit+"</span></a>");a("#edit-file").click(function(){a(this).hide();var c=new Date,c=l+"?mode=editfile&path="+encodeURIComponent(b.Path)+"&time="+c.getMilliseconds();
a.ajax({type:"GET",url:c,dataType:"json",async:!1,success:function(d){0==d.Code?(d='<form id="edit-form">'+('<textarea id="edit-content" name="content">'+d.Content+"</textarea>"),d=d+'<input type="hidden" name="mode" value="savefile" />'+('<input type="hidden" name="path" value="'+b.Path+'" />'),d+='<button id="edit-cancel" class="edition" type="button">'+f.quit_editor+"</button>",d+='<button id="edit-save" class="edition" type="button">'+f.save+"</button>",d+="</form>",a("#preview").find("img").hide(),
a("#preview").prepend(d).hide().fadeIn(),a("#edit-cancel").click(function(){a("#preview").find("form#edit-form").hide();a("#preview").find("img").fadeIn();a("#edit-file").show()}),a("#edit-save").click(function(){var b=codeMirrorEditor.getValue();a("textarea#edit-content").val(b);b=a("#edit-form").serializeArray();a.ajax({type:"POST",url:l,dataType:"json",data:b,async:!1,success:function(b){0==b.Code?(isEdited=!0,a.prompt(f.successful_edit)):(isEdited=!1,a.prompt(b.Error))}})}),codeMirrorEditor=instantiateCodeMirror(q(b.Path),
g)):(isEdited=!1,a.prompt(d.Error),a(this).show())}})});return isEdited},Y=function(b){a("#filetree").find('a[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});if(a("#uploader h1").attr("data-path")==b){var c=b.split("/").slice(0,length-2).join("/")+"/";n(c)}"grid"==a("#fileinfo").data("view")?a('#contents img[data-path="'+b+'"]').parent().parent().fadeOut("slow",function(){a(this).remove()}):a("table#contents").find('td[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});
a("#preview").length&&n(b.substr(0,b.lastIndexOf("/")+1))},W=function(b,c){var d='<li class="directory collapsed"><a data-path="'+b+c+'/" href="#">'+c+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>',e=a("#filetree").find('a[data-path="'+b+'"]');b!=fileRoot?e.next("ul").prepend(d).prev("a").click().click():(a("#filetree ul.jqueryFileTree").prepend(d),a("#filetree").find('li a[data-path="'+b+c+'/"]').attr("class","cap_rename cap_delete").click(function(){n(b+c+"/")}).each(function(){a(this).contextMenu({menu:t(a(this))},
function(b,e,d){e=a(e).attr("data-path");w(b,e)})}));g.options.showConfirmation&&a.prompt(f.successful_added_folder)},D=function(b){b.lastIndexOf("/")==b.length-1?(n(b),a("#filetree").find('a[data-path="'+b+'"]').click()):C(b)},w=function(b,c){var d=new Date;a.getJSON(l+"?mode=getinfo&path="+c+"&time="+d.getMilliseconds(),function(e){"grid"==a("#fileinfo").data("view")?a("#fileinfo").find('img[data-path="'+e.Path+'"]').parent():a("#fileinfo").find('td[data-path="'+e.Path+'"]').parent();switch(b){case "select":B(e);
break;case "download":window.location=l+"?mode=download&path="+e.Path+"&time="+d.getMilliseconds();break;case "rename":J(e);break;case "replace":L(e);break;case "move":K(e);break;case "delete":M(e)}})},C=function(b){var c=b.substr(0,b.lastIndexOf("/")+1);A(c);var d;d='<div id="preview"><img /><h1></h1><dl></dl></div><form id="toolbar">'+('<button id="parentfolder">'+f.parentfolder+"</button>");-1!=a.inArray("select",k)&&(a.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||a.urlParam("field_name"))&&
(d+='<button id="select" name="select" type="button" value="Select">'+f.select+"</button>");-1!=a.inArray("download",k)&&(d+='<button id="download" name="download" type="button" value="Download">'+f.download+"</button>");-1!=a.inArray("rename",k)&&1!=g.options.browseOnly&&(d+='<button id="rename" name="rename" type="button" value="Rename">'+f.rename+"</button>");-1!=a.inArray("move",k)&&1!=g.options.browseOnly&&(d+='<button id="move" name="move" type="button" value="Move">'+f.move+"</button>");-1!=
a.inArray("delete",k)&&1!=g.options.browseOnly&&(d+='<button id="delete" name="delete" type="button" value="Delete">'+f.del+"</button>");-1!=a.inArray("replace",k)&&1!=g.options.browseOnly&&(d+='<button id="replace" name="replace" type="button" value="Replace">'+f.replace+"</button>",d+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>',d+='<input id="mode" name="mode" type="hidden" value="replace" /> ',d+='<input id="newfilepath" name="newfilepath" type="hidden" />');
d+="</form>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(d):a("#fileinfo").html(d);a("#parentfolder").click(function(){n(c)});d=new Date;a.getJSON(l+"?mode=getinfo&path="+encodeURIComponent(b)+"&time="+d.getMilliseconds(),function(e){if(0==e.Code){a("#fileinfo").find("h1").text(e.Filename).attr("title",b);a("#fileinfo").find("img").attr("src",e.Preview);var d;d=-1!=a.inArray(q(e.Filename),g.videos.videosExt)?!0:!1;d&&1==g.videos.showVideoPlayer&&T(e);d=-1!=a.inArray(q(e.Filename),
g.audios.audiosExt)?!0:!1;d&&1==g.audios.showAudioPlayer&&U(e);d=-1!=a.inArray(q(e.Filename),g.edit.editExt)?!0:!1;d&&1==g.edit.enabled&&Z(e);d=new Date;var c=!1!==g.options.relPath?relPath+e.Path.replace(fileRoot,""):window.location.protocol+"//"+window.location.host+e.Path;a("#fileinfo").find("h1").append(' <a id="copy-button" data-clipboard-text="'+c+'" title="'+f.copy_to_clipboard+'" href="#"><span>'+f.copy_to_clipboard+"</span></a>");loadJS("./scripts/zeroclipboard/dist/ZeroClipboard.js");loadJS("./scripts/zeroclipboard/copy.js?d"+
d.getMilliseconds());a("#copy-button").click(function(){a("#fileinfo").find("h1").append('<span id="copied">'+f.copied+"</span>");a("#copied").delay(500).fadeOut(1E3,function(){a(this).remove()})});d="";e.Properties.Width&&""!=e.Properties.Width&&(d+="<dt>"+f.dimensions+"</dt><dd>"+e.Properties.Width+"x"+e.Properties.Height+"</dd>");e.Properties["Date Created"]&&""!=e.Properties["Date Created"]&&(d+="<dt>"+f.created+"</dt><dd>"+e.Properties["Date Created"]+"</dd>");e.Properties["Date Modified"]&&
""!=e.Properties["Date Modified"]&&(d+="<dt>"+f.modified+"</dt><dd>"+e.Properties["Date Modified"]+"</dd>");if(e.Properties.Size||0==parseInt(e.Properties.Size))d+="<dt>"+f.size+"</dt><dd>"+F(e.Properties.Size)+"</dd>";a("#fileinfo").find("dl").html(d);N(e)}else a.prompt(e.Error)})},n=function(b){A(b);var c='<img id="activity" src="themes/'+g.options.theme+'/images/wait30trans.gif" width="30" height="30" />';0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(c):a("#fileinfo").html(c);
c=new Date;b=l+"?path="+encodeURIComponent(b)+"&mode=getfolder&showThumbs="+g.options.showThumbs+"&time="+c.getMilliseconds();a.urlParam("type")&&(b+="&type="+a.urlParam("type"));a.getJSON(b,function(b){var e="";if("-1"==b.Code)G(b.Error);else{if(b)if("grid"==a("#fileinfo").data("view")){e+='<ul id="contents" class="grid">';for(key in b){var c=b[key].Properties,m="";for(cap in k)p(b[key],k[cap])&&(m+=" cap_"+k[cap]);var h=64,l=c.Width;1<l&&l<h&&(h=l);g.options.showTitleAttr?title=' title="'+b[key].Path+
'"':title="";e+='<li class="'+m+'"'+title+'"><div class="clip"><img src="'+b[key].Preview+'" width="'+h+'" alt="'+b[key].Path+'" data-path="'+b[key].Path+'" /></div><p>'+b[key].Filename+"</p>";c.Width&&""!=c.Width&&(e+='<span class="meta dimensions">'+c.Width+"x"+c.Height+"</span>");c.Size&&""!=c.Size&&(e+='<span class="meta size">'+c.Size+"</span>");c["Date Created"]&&""!=c["Date Created"]&&(e+='<span class="meta created">'+c["Date Created"]+"</span>");c["Date Modified"]&&""!=c["Date Modified"]&&
(e+='<span class="meta modified">'+c["Date Modified"]+"</span>");e+="</li>"}e+="</ul>"}else{e=e+'<table id="contents" class="list">'+('<thead><tr><th class="headerSortDown"><span>'+f.name+"</span></th><th><span>"+f.dimensions+"</span></th><th><span>"+f.size+"</span></th><th><span>"+f.modified+"</span></th></tr></thead>");e+="<tbody>";for(key in b){c=b[key].Properties;m="";g.options.showTitleAttr?title=' title="'+b[key].Path+'"':title="";for(cap in k)p(b[key],k[cap])&&(m+=" cap_"+k[cap]);e+='<tr class="'+
m+'">';e+='<td data-path="'+b[key].Path+'"'+title+'">'+b[key].Filename+"</td>";e=c.Width&&""!=c.Width?e+("<td>"+c.Width+"x"+c.Height+"</td>"):e+"<td></td>";e=c.Size&&""!=c.Size?e+('<td><abbr title="'+c.Size+'">'+F(c.Size)+"</abbr></td>"):e+"<td></td>";e=c["Date Modified"]&&""!=c["Date Modified"]?e+("<td>"+c["Date Modified"]+"</td>"):e+"<td></td>";e+="</tr>"}e+="</tbody>";e+="</table>"}else e+="<h1>"+f.could_not_retrieve_folder+"</h1>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(e):
a("#fileinfo").html(e);if("grid"==a("#fileinfo").data("view"))a("#fileinfo").find("#contents li").click(function(){var b=a(this).find("img").attr("data-path");D(b)}).each(function(){a(this).contextMenu({menu:t(a(this))},function(b,e,c){e=a(e).find("img").attr("data-path");w(b,e)})});else{a("#fileinfo tbody tr").click(function(){var b=a("td:first-child",this).attr("data-path");D(b)}).each(function(){a(this).contextMenu({menu:t(a(this))},function(b,e,c){e=a("td:first-child",e).attr("data-path");w(b,
e)})});a("#fileinfo").find("table").tablesorter({textExtraction:function(b){return a(b).find("abbr").size()?a(b).find("abbr").attr("title"):b.innerHTML}});var r=setInterval(function(){V(r)},300)}}})},X=function(b,c){var d=new Date,d=l+"?path="+encodeURIComponent(b)+"&mode=getfolder&showThumbs="+g.options.showThumbs+"&time="+d.getMilliseconds();a.urlParam("type")&&(d+="&type="+a.urlParam("type"));a.getJSON(d,function(a){var b="";if("-1"==a.Code)G(a.Error);else{if(a){b+='<ul class="jqueryFileTree" style="display: none;">';
for(key in a){var d="";for(cap in k)p(a[key],k[cap])&&(d+=" cap_"+k[cap]);"dir"==a[key]["File Type"]?b+='<li class="directory collapsed"><a href="#" class="'+d+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>":g.options.listFiles&&(b+='<li class="file ext_'+a[key]["File Type"].toLowerCase()+'"><a href="#" class="'+d+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>")}b+="</ul>"}else b+="<h1>"+f.could_not_retrieve_folder+"</h1>";c(b)}})};a(function(){if(g.extras.extra_js)for(var b=
0;b<g.extras.extra_js.length;b++)a.ajax({url:g.extras.extra_js[b],dataType:"script",async:g.extras.extra_js_async});loadCSS("./themes/"+g.options.theme+"/styles/filemanager.css");a.ajax({url:"./themes/"+g.options.theme+"/styles/ie.css",async:!1,success:function(b){a("head").append(b)}});if(g.customScrollbar.enabled){loadCSS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css");loadJS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js");var c=void 0!=g.customScrollbar.theme?
g.customScrollbar.theme:"inset-2-dark",d=void 0!=g.customScrollbar.button?g.customScrollbar.button:!0;a(window).load(function(){a("#filetree").mCustomScrollbar({theme:c,scrollButtons:{enable:d},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},axis:"yx"});a("#fileinfo").mCustomScrollbar({theme:c,scrollButtons:{enable:d},advanced:{autoExpandHorizontalScroll:!1,updateOnContentResize:!0},axis:"y"})})}g.edit.enabled&&(loadCSS("./scripts/CodeMirror/lib/codemirror.css"),loadCSS("./scripts/CodeMirror/theme/"+
g.edit.theme+".css"),loadJS("./scripts/CodeMirror/lib/codemirror.js"),loadJS("./scripts/CodeMirror/addon/selection/active-line.js"),loadJS("./scripts/CodeMirror/dynamic-mode.js"));g.options.fileRoot?(fileRoot=g.options.serverRoot?"/"+g.options.fileRoot:g.options.fileRoot,fileRoot=fileRoot.replace(/\/\//g,"/")):fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/";relPath=!1===g.options.relPath?window.location.protocol+"//"+window.location.host:
g.options.relPath;0!=a.urlParam("exclusiveFolder")&&(fileRoot+=a.urlParam("exclusiveFolder"),"/"!=fileRoot.charAt(fileRoot.length-1)&&(fileRoot+="/"),fileRoot=fileRoot.replace(/\/\//g,"/"));0!=a.urlParam("expandedFolder")?(expandedFolder=a.urlParam("expandedFolder"),fullexpandedFolder=fileRoot+expandedFolder):(expandedFolder="",fullexpandedFolder=null);1==g.options.autoload&&(a("#upload").append(f.upload),a("#newfolder").append(f.new_folder),a("#grid").attr("title",f.grid_view),a("#list").attr("title",
f.list_view),a("#fileinfo h1").append(f.select_from_left),a('#itemOptions a[href$="#select"]').append(f.select),a('#itemOptions a[href$="#download"]').append(f.download),a('#itemOptions a[href$="#rename"]').append(f.rename),a('#itemOptions a[href$="#move"]').append(f.move),a('#itemOptions a[href$="#replace"]').append(f.replace),a('#itemOptions a[href$="#delete"]').append(f.del));a.urlParam("CKEditorCleanUpFuncNum")&&(a("body").append('<button id="close-btn" type="button">'+f.close+"</button>"),a("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))}));
a("#browse").append("+");a("#browse").attr("title",f.browse);a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))});!0===g.options.searchBox?loadJS("./scripts/filemanager.liveSearch.min.js"):a("#search").remove();a("button").wrapInner("<span></span>");a("#fileinfo").data("view",g.options.defaultViewMode);y(g.options.defaultViewMode);a("#home").click(function(){var b=a("#fileinfo").data("view");a("#fileinfo").data("view",b);a("#filetree>ul>li.expanded>a").trigger("click");
n(fileRoot)});a("#grid").click(function(){y("grid");a("#fileinfo").data("view","grid");n(a("#currentpath").val())});a("#list").click(function(){y("list");a("#fileinfo").data("view","list");n(a("#currentpath").val())});A(fileRoot);a("#uploader").attr("action",l);a("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(b,c,d){if(""==a("#newfile",c).val())return!1;if(!H(a("#newfile",c).val()))return c="<p>"+f.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==g.security.uploadPolicy&&(c+="<p>"+
f.ALLOWED_FILE_TYPE+g.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==g.security.uploadPolicy&&(c+="<p>"+f.DISALLOWED_FILE_TYPE+g.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(c),!1;a("#upload").attr("disabled",!0);a("#upload span").addClass("loading").text(f.loading_data);if("images"==a.urlParam("type").toString().toLowerCase()){b=a("#newfile",c).val().toLowerCase().split(".");d=!1;for(key in g.images.imagesExt)g.images.imagesExt[key]==b[b.length-1]&&
(d=!0);if(!1===d)return a.prompt(f.UPLOAD_IMAGES_ONLY),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1}if("undefined"!==typeof FileReader&&"auto"!=typeof g.upload.fileSizeLimit&&a("#newfile",c).get(0).files[0].size>1048576*g.upload.fileSizeLimit)return a.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+g.upload.fileSizeLimit+" "+f.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1},error:function(b,
c,d){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);a.prompt(f.ERROR_UPLOADING_FILE)},success:function(b){b=jQuery.parseJSON(a("#uploadresponse").find("textarea").text());if(0==b.Code){var c=b.Path,d=b.Name,h=q(d),l=a("#filetree").find('a[data-path="'+c+'"]'),k=l.parent(),d='<li class="file ext_'+h+'"><a data-path="'+c+d+'" href="#" class="">'+d+"</a></li>";k.find("ul").size()?(k.find("ul").prepend(d),l.click().click()):(k=a("#filetree").find("ul.jqueryFileTree"),
k.prepend(d),x());n(c);g.options.showConfirmation&&a.prompt(f.successful_added_file);a("#filepath, #newfile").val("");a.browser.msie&&a("#newfile").replaceWith(a("#newfile").clone(!0));a("#filetree").find('a[data-path="'+b.Path+'/"]').click().click()}else a.prompt(b.Error);a("#upload").removeAttr("disabled");a("#upload span").removeClass("loading").text(f.upload);a("#filepath").val("")}});x();window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a('#itemOptions a[href$="#select"]').remove();
1==g.options.browseOnly&&(a("#file-input-container").remove(),a("#upload").remove(),a("#newfolder").remove(),a("#toolbar").remove("#rename"),a(".contextMenu .rename").remove(),a(".contextMenu .move").remove(),a(".contextMenu .replace").remove(),a(".contextMenu .delete").remove());E();a(window).resize(E);a("#splitter").splitter({sizeLeft:200});D(fileRoot+expandedFolder)});document.documentElement.setAttribute("data-useragent",navigator.userAgent);g.options.logger&&(u=(new Date).getTime()-Q,console.log("Total execution time : "+
u+" ms"))})(jQuery);
